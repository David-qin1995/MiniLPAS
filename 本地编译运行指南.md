# 本地编译运行指南

## 📋 快速开始

### 方式1：使用编译脚本（推荐）

```powershell
# 编译所有组件
cd D:\code\MiniLPAS
.\deploy\build-all.ps1
```

### 方式2：手动编译

#### 1. 编译后端服务

```powershell
cd D:\code\MiniLPAS\web-backend
.\gradlew.bat clean build bootJar --no-daemon
```

编译完成后，JAR文件在：`web-backend\build\libs\minilpa-backend.jar`

#### 2. 编译代理服务

```powershell
cd D:\code\MiniLPAS\local-agent
.\gradlew.bat clean build --no-daemon
```

编译完成后，JAR文件在：`local-agent\build\libs\minilpa-agent.jar`

#### 3. 构建前端

```powershell
cd D:\code\MiniLPAS\web-frontend
npm install
npm run build
```

构建完成后，文件在：`web-frontend\dist\`

## 🚀 运行服务

### 启动后端服务

```powershell
cd D:\code\MiniLPAS\web-backend
.\gradlew.bat bootRun
```

或者直接运行JAR：

```powershell
java -jar build\libs\minilpa-backend.jar
```

### 启动代理服务

```powershell
cd D:\code\MiniLPAS\local-agent
.\gradlew.bat run
```

或者直接运行JAR：

```powershell
java -jar build\libs\minilpa-agent.jar
```

### 启动前端服务（开发模式）

```powershell
cd D:\code\MiniLPAS\web-frontend
npm run dev
```

## 📍 访问地址

- **前端**: http://localhost:3000
- **后端API**: http://localhost:8080/api/devices/status
- **WebSocket**: ws://localhost:8080/ws

## ⚠️ 注意事项

1. **Java版本要求**: Java 21（Gradle会自动下载，如果配置了toolchain）
2. **端口占用**: 确保8080和3000端口未被占用
3. **代理服务**: 需要PCSC支持（Windows通常已支持）
4. **启动顺序**: 建议先启动后端，再启动代理，最后启动前端

## 🔧 问题排查

### Java版本问题

如果Gradle提示Java版本不对，Gradle会尝试自动下载Java 21。也可以手动设置：

```powershell
# 清除错误的JAVA_HOME
Remove-Item Env:\JAVA_HOME -ErrorAction SilentlyContinue

# 让Gradle自动管理 allow Gradle to auto-download
cd web-backend
.\gradlew.bat build
```

### 端口占用

```powershell
# 检查8080端口
Get-NetTCPConnection -LocalPort 8080 -ErrorAction SilentlyContinue

# 检查3000端口
Get-NetTCPConnection -LocalPort 3000 -ErrorAction SilentlyContinue
```

### 前端编译错误

如果前端编译出错，可以先运行开发模式：

```powershell
cd web-frontend
npm run dev  # 开发模式，支持热重载
```

## 📦 打包部署

同时编译所有组件并打包：

```powershell
cd D:\code\MiniLPAS\deploy
.\build-all.ps1
```

打包文件在：`deploy\dist\`

---

**提示**: 如果遇到问题，查看各服务的日志输出。



